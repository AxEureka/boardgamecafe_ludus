<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒœãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ æ¤œç´¢</title>
<link rel="stylesheet" href="search.css">
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
</head>
<body>

<header>
  <h2>ãªã«ã—ã¦éŠã¼ã†ã‹ï¼Ÿ</h2>
</header>

<main>
  <!-- ğŸ” æ¤œç´¢å…¥åŠ› -->
  <div class="section search-row">
    <input type="text" id="keyword" placeholder="ã‚²ãƒ¼ãƒ åã§æ¤œç´¢">
    <button id="search-button" class="search-btn">æ¤œç´¢</button>
    <button id="catalog-button" class="search-btn">ç›®éŒ²ã‚’è¦‹ã‚‹</button>
  </div>

  <!-- ğŸ‘¥ äººæ•° -->
  <div class="section">
    <label><strong>äººæ•°</strong></label>
    <div class="checkbox-group" id="player-options">
      <label><input type="checkbox" value="2">2äººã§</label>
      <label><input type="checkbox" value="3-4">1ãƒ†ãƒ¼ãƒ–ãƒ«(3ï½4äºº)</label>
      <label><input type="checkbox" value="5-6">ã¿ã‚“ãªã§(5ï½6äºº)</label>
      <label><input type="checkbox" value="7+">é›†ã¾ã‚Œ!(7äººä»¥ä¸Š)</label>
    </div>
  </div>

  <!-- â± æ™‚é–“ -->
  <div class="section">
    <label><strong>æ™‚é–“</strong></label>
    <div class="checkbox-group" id="time-options">
      <label><input type="checkbox" value="0-10">ã•ãã£ã¨(ï½10åˆ†)</label>
      <label><input type="checkbox" value="11-30">ã˜ã£ãã‚Š(ï½30åˆ†)</label>
      <label><input type="checkbox" value="31-60">ãŒã£ã¤ã‚Š(ï½60åˆ†)</label>
      <label><input type="checkbox" value="61+">ãŸã£ã·ã‚Š(60åˆ†ï½)</label>
    </div>
  </div>

  <!-- ğŸ­ æ°—åˆ† -->
  <div class="section">
    <label><strong>æ°—åˆ†</strong></label>
    <div class="checkbox-group" id="mood-options">
      <label><input type="checkbox" value="ãƒãƒãƒãƒ">ãƒãƒãƒãƒ</label>
      <label><input type="checkbox" value="ã‚ã„ã‚ã„">ã‚ã„ã‚ã„</label>
      <label><input type="checkbox" value="é›†ä¸­">é›†ä¸­</label>
      <label><input type="checkbox" value="æ²¡å…¥">æ²¡å…¥</label>
      <label><input type="checkbox" value="ãƒ‰ã‚­ãƒ‰ã‚­">ãƒ‰ã‚­ãƒ‰ã‚­</label>
      <label><input type="checkbox" value="ãªã‚‹ã»ã©">ãªã‚‹ã»ã©</label>
    </div>
  </div>

  <!-- ğŸ§© ã‚¸ãƒ£ãƒ³ãƒ« -->
  <div class="section">
    <label><strong>ã‚¸ãƒ£ãƒ³ãƒ«</strong></label>
    <div class="checkbox-group" id="genre-options">
      <label><input type="checkbox" value="ãƒœãƒ¼ãƒ‰">ãƒœãƒ¼ãƒ‰</label>
      <label><input type="checkbox" value="ã‚«ãƒ¼ãƒ‰">ã‚«ãƒ¼ãƒ‰</label>
      <label><input type="checkbox" value="ãƒ€ã‚¤ã‚¹">ãƒ€ã‚¤ã‚¹</label>
      <label><input type="checkbox" value="å°é“å…·">å°é“å…·</label>
      <label><input type="checkbox" value="ãƒ‡ãƒƒã‚­æ§‹ç¯‰">ãƒ‡ãƒƒã‚­æ§‹ç¯‰</label>
      <label><input type="checkbox" value="é™£å–ã‚Š">é™£å–ã‚Š</label>
      <label><input type="checkbox" value="ãƒˆãƒªãƒƒã‚¯ãƒ†ã‚¤ã‚­ãƒ³ã‚°">ãƒˆãƒªãƒƒã‚¯ãƒ†ã‚¤ã‚­ãƒ³ã‚°</label>
      <label><input type="checkbox" value="è„±è½ã‚ã‚Š">è„±è½ã‚ã‚Š</label>
      <label><input type="checkbox" value="å½¹è·">å½¹è·</label>
      <label><input type="checkbox" value="éš åŒ¿">éš åŒ¿</label>
      <label><input type="checkbox" value="å¿ƒç†æˆ¦">å¿ƒç†æˆ¦</label>
      <label><input type="checkbox" value="ä¼šè©±">ä¼šè©±</label>
      <label><input type="checkbox" value="å¤§å–œåˆ©">å¤§å–œåˆ©</label>
      <label><input type="checkbox" value="ãƒãƒ¼ãƒ æˆ¦">ãƒãƒ¼ãƒ æˆ¦</label>
      <label><input type="checkbox" value="é‹ã‚²ãƒ¼">é‹ã‚²ãƒ¼</label>
      <label><input type="checkbox" value="ã‚¢ã‚¯ã‚·ãƒ§ãƒ³">ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</label>
      <label><input type="checkbox" value="ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼">ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼</label>
    </div>
  </div>

  <!-- ğŸ· ãƒ†ãƒ¼ãƒ -->
  <div class="section">
    <label><strong>ãƒ†ãƒ¼ãƒ</strong></label>
    <div class="checkbox-group" id="theme-options">
      <label><input type="checkbox" value="æ¨ç†">æ¨ç†</label>
      <label><input type="checkbox" value="ãƒ›ãƒ©ãƒ¼">ãƒ›ãƒ©ãƒ¼</label>
      <label><input type="checkbox" value="ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼">ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼</label>
      <label><input type="checkbox" value="å­¦åœ’">å­¦åœ’</label>
      <label><input type="checkbox" value="æ—¥å¸¸">æ—¥å¸¸</label>
      <label><input type="checkbox" value="éæ—¥å¸¸">éæ—¥å¸¸</label>
      <label><input type="checkbox" value="ãƒãƒˆãƒ«">ãƒãƒˆãƒ«</label>
      <label><input type="checkbox" value="æ‹æ„›">æ‹æ„›</label>
      <label><input type="checkbox" value="æ–‡å­¦">æ–‡å­¦</label>
      <label><input type="checkbox" value="ç¥è©±">ç¥è©±</label>
      <label><input type="checkbox" value="ç«¥è©±">ç«¥è©±</label>
      <label><input type="checkbox" value="ã‚¢ãƒ¼ãƒˆ">ã‚¢ãƒ¼ãƒˆ</label>
      <label><input type="checkbox" value="é‘‘è³">é‘‘è³</label>
      <label><input type="checkbox" value="é–‹æ‹“">é–‹æ‹“</label>
      <label><input type="checkbox" value="äº¤æ¸‰">äº¤æ¸‰</label>
      <label><input type="checkbox" value="çµŒæ¸ˆ">çµŒæ¸ˆ</label>
      <label><input type="checkbox" value="æ•°å­—">æ•°å­—</label>
      <label><input type="checkbox" value="åŒ»ç™‚">åŒ»ç™‚</label>
      <label><input type="checkbox" value="å®‡å®™">å®‡å®™</label>
      <label><input type="checkbox" value="æµ·">æµ·</label>
      <label><input type="checkbox" value="å‹•ç‰©">å‹•ç‰©</label>
      <label><input type="checkbox" value="æ¤ç‰©">æ¤ç‰©</label>
      <label><input type="checkbox" value="é£Ÿã¹ç‰©ãƒ»é£²ã¿ç‰©">é£Ÿã¹ç‰©ãƒ»é£²ã¿ç‰©</label>
    </div>
  </div>

  <!-- ğŸ¢ ãƒ–ãƒ©ãƒ³ãƒ‰ -->
  <div class="section">
    <label><strong>ãƒ–ãƒ©ãƒ³ãƒ‰</strong></label>
    <div class="checkbox-group" id="brand-options">
      <label><input type="checkbox" value="ã‚¢ãƒ¼ã‚¯ãƒ©ã‚¤ãƒˆ">ã‚¢ãƒ¼ã‚¯ãƒ©ã‚¤ãƒˆ</label>
      <label><input type="checkbox" value="ã‚ªã‚¤ãƒ³ã‚¯ã‚²ãƒ¼ãƒ ã‚º">ã‚ªã‚¤ãƒ³ã‚¯ã‚²ãƒ¼ãƒ ã‚º</label>
      <label><input type="checkbox" value="Group SNE">Group SNE</label>
      <label><input type="checkbox" value="å¹»å†¬èˆ">å¹»å†¬èˆ</label>
      <label><input type="checkbox" value="ã™ã”ã‚ãã‚„">ã™ã”ã‚ãã‚„</label>
      <label><input type="checkbox" value="ãƒ‹ãƒ¥ãƒ¼ã‚²ãƒ¼ãƒ ã‚ºã‚ªãƒ¼ãƒ€ãƒ¼">ãƒ‹ãƒ¥ãƒ¼ã‚²ãƒ¼ãƒ ã‚ºã‚ªãƒ¼ãƒ€ãƒ¼</label>
      <label><input type="checkbox" value="ãƒ›ãƒ“ãƒ¼ã‚¸ãƒ£ãƒ‘ãƒ³">ãƒ›ãƒ“ãƒ¼ã‚¸ãƒ£ãƒ‘ãƒ³</label>
      <label><input type="checkbox" value="ãƒ¡ãƒ“ã‚¦ã‚¹ã‚²ãƒ¼ãƒ ã‚º">ãƒ¡ãƒ“ã‚¦ã‚¹ã‚²ãƒ¼ãƒ ã‚º</label>
      <label><input type="checkbox" value="ãã®ä»–">ãã®ä»–</label>
    </div>
  </div>

  <div class="btn-container">
    <button id="clear-button" class="top-btn">æ¡ä»¶ã‚¯ãƒªã‚¢</button>
    <button id="top-button" class="top-btn">ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹</button>
  </div>

</main>

<!-- ğŸŒ™ ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
<div id="result-overlay" class="overlay hidden">
  <div class="overlay-bg"></div>
  <div class="overlay-content">
    <button id="close-overlay" class="close-btn">âœ•</button>
    <div id="search-results"></div>
  </div>
</div>

<script>
function escapeHtml(s){
  return (s||"").replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}

function createGameCard(game) {
  const card = document.createElement("div");
  card.className = "game-card";
  const imageSrc = Array.isArray(game.images) ? game.images[0] : game.image || 'images/no_image.png';
  card.innerHTML = `
    <a href="detail.html?title=${encodeURIComponent(game.title)}">
      <img src="${imageSrc}" alt="${game.title}">
      <p class="game-title">${game.title}</p>
      <p class="game-desc">${game.desc}</p>
    </a>
  `;
  return card;
}

function getCheckedValues(id){
  return Array.from(document.querySelectorAll(`#${id} input:checked`)).map(el=>el.value);
}

function matchesRange(valueRange, filters){
  return filters.some(f=>{
    if(f.endsWith("+")){
      const min = parseInt(f);
      return valueRange[1] >= min;
    }
    const [minStr,maxStr] = f.split("-");
    const min = parseInt(minStr);
    const max = maxStr ? parseInt(maxStr) : min;
    return valueRange[0] <= max && valueRange[1] >= min;
  });
}

function renderResults(games){
  const overlay = document.getElementById("result-overlay");
  const resultsDiv = document.getElementById("search-results");

  if(games.length===0){
    resultsDiv.innerHTML = "<p>æ¡ä»¶ã«åˆã†ã‚²ãƒ¼ãƒ ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>";
  } else {
    resultsDiv.innerHTML = "";
    const grid = document.createElement("div");
    grid.className = "game-cards";
    games.forEach(game => grid.appendChild(createGameCard(game)));
    resultsDiv.appendChild(grid);

    const cards = resultsDiv.querySelectorAll(".game-card");
    cards.forEach((card, i) => {
      card.style.animationDelay = `${i * 0.1}s`;
    });
  }

  overlay.classList.remove("hidden");
  setTimeout(()=>overlay.classList.add("active"),10);
}

async function loadGames(){
  const res = await fetch("data/games.json");
  return await res.json();
}

async function searchGames(){
  const games = await loadGames();
  const keyword = document.getElementById("keyword").value.trim();
  const players = getCheckedValues("player-options");
  const times = getCheckedValues("time-options");
  const moods = getCheckedValues("mood-options");
  const genres = getCheckedValues("genre-options");
  const themes = getCheckedValues("theme-options");
  const brands = getCheckedValues("brand-options");

  const filtered = games.filter(game=>{
    return (!keyword || game.title.includes(keyword)) &&
           (players.length===0 || (game.players && matchesRange(game.players, players))) &&
           (times.length===0 || (game.time && matchesRange(game.time, times))) &&
           (moods.length===0 || (game.mood||[]).some(m=>moods.includes(m))) &&
           (genres.length===0 || (game.genre||[]).some(g=>genres.includes(g))) &&
           (themes.length===0 || (game.theme||[]).some(t=>themes.includes(t))) &&
           (brands.length===0 || (game.brand||[]).some(b=>brands.includes(b)));
  });

  renderResults(filtered);
}

// --- è¿½åŠ : ç›®éŒ²ãƒœã‚¿ãƒ³ ---
document.getElementById("catalog-button").addEventListener("click", async () => {
  const games = await loadGames();
  const sortedGames = [...games];
  const overlay = document.getElementById("result-overlay");
  const resultsDiv = document.getElementById("search-results");

  resultsDiv.innerHTML = "<h3>ã‚²ãƒ¼ãƒ ç›®éŒ²</h3>";

  const list = document.createElement("ul");
  list.style.listStyle = "none";
  list.style.padding = "0";

  sortedGames.forEach(game=>{
    const li = document.createElement("li");
    li.style.margin = "6px 0";

    const a = document.createElement("a");
    a.href = `detail.html?title=${encodeURIComponent(game.title)}`;
    a.textContent = game.title;
    a.style.color = "ffffff";
    a.style.textDecoration = "underline";

    li.appendChild(a);
    list.appendChild(li);
  });

  resultsDiv.appendChild(list);
  overlay.classList.remove("hidden");
  setTimeout(()=>overlay.classList.add("active"),10);
});

// --- æ—¢å­˜ã‚¤ãƒ™ãƒ³ãƒˆ ---
document.getElementById("search-button").addEventListener("click", searchGames);
document.getElementById("clear-button").addEventListener("click", ()=>{
  document.querySelectorAll("input[type=checkbox]").forEach(cb=>cb.checked=false);
  document.getElementById("keyword").value="";
});
document.getElementById("top-button").addEventListener("click", ()=>{ window.location.href="index.html"; });
document.getElementById("close-overlay").addEventListener("click", ()=>{
  const overlay=document.getElementById("result-overlay");
  overlay.classList.remove("active");
  setTimeout(()=>overlay.classList.add("hidden"),800);
});
</script>
</body>
</html>
